﻿@using DocumentSharing.Models;
@model List<Document>;

@{
    ViewData["Title"] = "DocumentList";
    int totalPage = ViewBag.TotalPage;
    int pageActive = ViewBag.PageActive;
    string delete = ViewBag.Delete;
}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
    .detail {
        color: aquamarine;
    }

        .detail:hover {
            background-color: #00796b;
            color: #e0f7fa;
            transform: scale(1.1);
            cursor: pointer;
        }

    .delete {
        background-color: #ffebee;
        color: #c62828;
    }

        .delete:hover {
            background-color: #c62828;
            color: #ffebee;
            transform: scale(1.1);
            cursor: pointer;
        }

    .pagination {
        display: inline-block;
    }

        .pagination a {
            color: black;
            float: left;
            padding: 8px 16px;
            text-decoration: none;
        }

            .pagination a.active {
                background-color: #4CAF50;
                color: white;
            }

            .pagination a:hover:not(.active) {
                background-color: #ddd;
            }
</style>
<h1 class="text-primary text-center">Danh sách tài liệu</h1>
<div class="container my-5">
    <a href="/Document/Add" class="btn btn-primary p-3 mb-3">Thêm</a>
    <table class="table table-hover table-responsive">
        <thead class="thead-dark">
            <tr>
                <th>Mã tài liệu</th>
                <th>Tên tài liệu</th>
                <th>Loại tài liệu</th>
                <th>Môn học</th>
                <th>Người đăng</th>
                <th>Trạng thái</th>
                <th>Link</th>
                <th>Chi tiết</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                <tr ondblclick="Update('@item.DocId')">
                    <td>@item.DocId</td>
                    <td>@item.DocName</td>
                    <td>@item.DocCategory</td>
                    <td>@item.SubjectId</td>
                    <td>@item.UserId</td>
                    @if (item.DocStatus == true)
                    {
                        <td>Đã duyệt</td>
                    }
                    else
                    {
                        <td>Chưa duyệt</td>
                    }
                    <td><a href="@item.DocUrl">icon</a></td>
                    <td>
                        <i class="fas fa-eye detail"></i>
                        <a onclick="Delete('@item.DocId', @pageActive)"><i data-id="@item.DocId" class="fas fa-trash-alt delete"></i></a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
    <div class="pagination">
        <a href="#">&laquo;</a>
        @for (int i = 1; i <= totalPage; i++)
        {
            if(i == pageActive)
            {
                <a href="/Document/DocumentList?pageNumber=@i" class="active">@i</a>
            }
            else
            {
                <a href="/Document/DocumentList?pageNumber=@i">@i</a>
            }
        }
        <a href="#">&raquo;</a>
    </div>
</div>

<script>
    function Delete(id, pageNumber) {
        var a = confirm('Bạn có chắc muốn xóa tài liệu có mã ' + id + '?');
        if (a) {
            $.ajax({
                url: '/Document/Delete',
                method: 'POST',
                data: { id: id, pageNumber: pageNumber },
                success: function (response) {
                    alert('Xóa thành công!');
                    location.reload(); // Tải lại trang để cập nhật danh sách tài liệu
                },
                error: function (error) {
                    alert('Có lỗi xảy ra!');
                }
            });
        }
    }

</script>

@*Ajax Jquery
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        $('.delete').click(function () {
            var id = $(this).data('id');
            console.log('ID:', id);
            if (confirm('Bạn có chắc muốn xóa?')) {
                $.ajax({
                    url: '/Document/Delete?id=' + id, // URL đến action xóa trong controller
                    type: 'POST',
                    success: function (result) {
                        if (result.success) {
                            // Xóa hàng theo data-id được click
                            $('i[data-id="' + id + '"]').closest('tr').remove();
                        } else {
                            alert('Dữ liệu đã được tham chiếu, không thể xóa');
                        }
                    }
                });
            }
        });
    });

    function Update(item) {
        window.location.href = '/Document/Update?id=' + item;
    }
</script>*@